name: Deploy to Cloudflare Pages (OpenNext)

# â”€â”€â”€ Trigger â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
on:
  push:
    branches: [ main ]        # change if you deploy from a different branch
  workflow_dispatch:          # lets you trigger a manual deploy from the UI

# â”€â”€â”€ Job â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      # 1  Check out your repository
      - name: â¬ Checkout code
        uses: actions/checkout@v4

      # 2  Install Node (and cache node_modules)
      - name: âš™ï¸  Set up Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 20          # keep in sync with your .nvmrc / package.json
          cache: npm

      # 3  Install dependencies
      - name: ğŸ“¦ Install dependencies
        run: npm ci                 # deterministic install via package-lock.json

      # 4  Build + Deploy with OpenNext
      - name: ğŸš€ Build & Deploy to Cloudflare Pages
        run: npm run deploy         # runs: opennextjs-cloudflare build && â€¦ deploy
        env:
          # you only need the token; account_id is already in wrangler.jsonc
          CLOUDFLARE_API_TOKEN: ${{ secrets.CLOUDFLARE_API_TOKEN }}
